<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misskey ì»¤ìŠ¤í…€ ì´ëª¨ì§€ JSON ë©”ì´ì»¤</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/ONE-Mobile-POP.woff" as="font" type="font/woff" crossorigin>
    <style>
        @font-face {
            font-family: 'ONE-Mobile-POP';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/ONE-Mobile-POP.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background-color: #fffbe7;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            font-family: ONE-Mobile-POP, sans-serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #58524b;
            text-align: center;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            text-align: center;
            font-size: 14px;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border: 0px solid #e5e1cf;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: #efb33b;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e09a25;
        }

        td {
            padding: 0;
            border: 1px solid #e5e1cf;
        }

        input {
            width: 100%;
            padding: 12px;
            border: none;
            outline: none;
            font-size: 14px;
            font-family: inherit;
            background: transparent;
            user-select: none;
        }

        input:focus {
            background: #fff9e6;
            user-select: text;
        }

        tr:hover td {
            background: #fafafa;
        }

        .row-number {
            background: #f3f2e9;
            color: #666;
            text-align: center;
            font-weight: 500;
            padding: 12px 8px;
            min-width: 50px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        button {
            background-color: #efb33b;
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(239, 179, 59, 0.3);
        }

        button:hover {
            background-color: #f09e75;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(240, 158, 117, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.success {
            background-color: #38ef7d;
            box-shadow: 0 2px 8px rgba(56, 239, 125, 0.3);
        }

        button.success:hover {
            background-color: #11998e;
        }

        .info {
            background: #fff9e6;
            border-left: 4px solid #efb33b;
            padding: 12px 16px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            color: #8b6914;
        }

        .info-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #6b4e0f;
        }

        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e1cf;
            text-align: center;
            font-size: 13px;
            color: #999;
        }

        .footer a {
            color: #efb33b;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: #f09e75;
        }

        input.selected {
            background: #ffeaa7 !important;
            outline: 2px solid #efb33b;
        }

        .bulk-input-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 350px;
        }

        .bulk-input-container.show {
            display: block;
        }

        .bulk-input-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .bulk-input-field {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e1cf;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            margin-bottom: 12px;
        }

        .bulk-input-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .bulk-input-buttons button {
            padding: 8px 20px;
            font-size: 14px;
        }

        .bulk-cancel {
            background-color: #999 !important;
        }

        .bulk-cancel:hover {
            background-color: #777 !important;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .tools-panel {
            background: white;
            border: 1px solid #e5e1cf;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .tool-section {
            display: flex;
            flex-direction: column;
        }

        .tool-label {
            font-size: 13px;
            font-weight: 600;
            color: #6b4e0f;
            margin-bottom: 8px;
            display: block;
        }

        .tool-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .tool-input {
            padding: 8px 12px;
            border: 1px solid #e5e1cf;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            flex: 1;
            min-width: 100px;
        }

        .tool-input:focus {
            outline: none;
            border-color: #efb33b;
            background: #fffdf7;
        }

        .tool-button {
            padding: 8px 16px;
            font-size: 13px;
            background-color: #efb33b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            white-space: nowrap;
        }

        .tool-button:hover {
            background-color: #f09e75;
            transform: translateY(-1px);
        }

        .tool-button:active {
            transform: translateY(0);
        }

        @media (max-width: 1024px) {
            .tools-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Misskey ì»¤ìŠ¤í…€ ì´ëª¨ì§€ JSON ë©”ì´ì»¤</h1>
        <p class="subtitle">ë‹¤ëŸ‰ì˜ ì»¤ìŠ¤í…€ ì´ëª¨ì§€ë¥¼ ì¼ê´„ ë“±ë¡í•˜ëŠ” meta.json íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. </p>
        <div class="info">
            <div class="info-title">ğŸ’¡ ì‚¬ìš© ë°©ë²•</div>
            <div>
                â€¢ í‘œì— ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ì—‘ì…€/ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                â€¢ ë§Œë“¤ì–´ì§„ meta.json íŒŒì¼ê³¼ ì´ëª¨ì§€ íŒŒì¼ì„ ì••ì¶•í•œ ë’¤, ì»¤ìŠ¤í…€ ì´ëª¨ì§€ ê´€ë¦¬ ì°½ì—ì„œ [ê°€ì ¸ì˜¤ê¸°]ë¡œ ì—…ë¡œë“œí•˜ì‹œë©´ ì¼ê´„ë¡œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            </div>
        </div>

        <div class="tools-panel">
            <div class="tool-section">
                <label class="tool-label">íŒŒì¼ëª… í™•ì¥ì ì¼ê´„ ì¶”ê°€</label>
                <div class="tool-row">
                    <input type="text" id="extensionInput" class="tool-input" value=".png" placeholder=".png">
                    <button class="tool-button" onclick="addExtension()">ì¶”ê°€</button>
                </div>
            </div>
            
            <div class="tool-section">
                <label class="tool-label">ì´ë¦„ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ ì¼ê´„ ì¶”ê°€</label>
                <div class="tool-row">
                    <input type="text" id="prefixInput" class="tool-input" placeholder="ì ‘ë‘ì‚¬">
                    <button class="tool-button" onclick="addPrefix()">ì¶”ê°€</button>
                </div>
                <div class="tool-row" style="margin-top: 8px;">
                    <input type="text" id="suffixInput" class="tool-input" placeholder="ì ‘ë¯¸ì‚¬">
                    <button class="tool-button" onclick="addSuffix()">ì¶”ê°€</button>
                </div>
            </div>
            
            <div class="tool-section">
                <label class="tool-label">ì¹´í…Œê³ ë¦¬ ì¼ê´„ ì¶”ê°€</label>
                <div class="tool-row">
                    <input type="text" id="categoryInput" class="tool-input" placeholder="ì¹´í…Œê³ ë¦¬/í•˜ìœ„ ì¹´í…Œê³ ë¦¬">
                    <button class="tool-button" onclick="addCategory()">ì¶”ê°€</button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <table id="emojiTable">
                <thead>
                    <tr>
                        <th style="width: 50px;">#</th>
                        <th style="width: 25%;">íŒŒì¼ëª…</th>
                        <th style="width: 20%;">ì´ë¦„</th>
                        <th style="width: 25%;">ì¹´í…Œê³ ë¦¬</th>
                        <th style="width: 30%;">íƒœê·¸</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>

        <div class="button-container">
            <button id="generateBtn" onclick="generateJSON()">
                meta.json ë§Œë“¤ê¸°
            </button>
        </div>

        <div class="footer">
            Powered by <a href="http://buttersc.one" target="_blank" rel="noopener noreferrer">buttersc.one</a>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeBulkInput()"></div>
    <div class="bulk-input-container" id="bulkInputModal">
        <div class="bulk-input-title">ì„ íƒí•œ ì…€ì— ì¼ê´„ ì…ë ¥</div>
        <input type="text" id="bulkInputField" class="bulk-input-field" placeholder="ì…ë ¥í•  ê°’ì„ ì…ë ¥í•˜ì„¸ìš”">
        <div class="bulk-input-buttons">
            <button class="bulk-cancel" onclick="closeBulkInput()">ì·¨ì†Œ</button>
            <button onclick="applyBulkInput()">ì ìš©</button>
        </div>
    </div>

    <script>
        let rowCount = 0;
        let selectedInputs = new Set();
        let isDragging = false;
        let lastFocusedInput = null;
        let dragStartInput = null;

        // ì´ˆê¸° í–‰ ì¶”ê°€
        function init() {
            for (let i = 0; i < 5; i++) {
                addRow();
            }
            
            // ì „ì—­ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + I: ì¼ê´„ ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
                if ((e.ctrlKey || e.metaKey) && e.key === 'i' && selectedInputs.size > 0) {
                    e.preventDefault();
                    openBulkInput();
                }
            });

            // ë§ˆìš°ìŠ¤ ì—… ì´ë²¤íŠ¸ë¡œ ë“œë˜ê·¸ ì¢…ë£Œ
            document.addEventListener('mouseup', function() {
                isDragging = false;
                dragStartInput = null;
            });
        }

        // ìƒˆ í–‰ ì¶”ê°€
        function addRow() {
            rowCount++;
            const tbody = document.getElementById('tableBody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="row-number">${rowCount}</td>
                <td><input type="text" data-col="0" data-row="${rowCount - 1}" placeholder="scone.png"></td>
                <td><input type="text" data-col="1" data-row="${rowCount - 1}" placeholder="scone_image"></td>
                <td><input type="text" data-col="2" data-row="${rowCount - 1}" placeholder="ì¹´í…Œê³ ë¦¬/í•˜ìœ„ ì¹´í…Œê³ ë¦¬"></td>
                <td><input type="text" data-col="3" data-row="${rowCount - 1}" placeholder="ìŠ¤ì½˜, ìŠ¥ê³¤"></td>
            `;
            tbody.appendChild(row);

            // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', handleInput);
                input.addEventListener('keydown', handleKeydown);
                input.addEventListener('paste', handlePaste);
                input.addEventListener('click', handleInputClick);
                input.addEventListener('mousedown', handleMouseDown);
                input.addEventListener('mouseover', handleMouseOver);
                input.addEventListener('focus', handleFocus);
            });
        }

        // ì…ë ¥ ì²˜ë¦¬ (ìë™ í–‰ ì¶”ê°€/ì œê±°)
        function handleInput(e) {
            const inputs = document.querySelectorAll('#tableBody input');
            const tbody = document.getElementById('tableBody');
            const rows = tbody.querySelectorAll('tr');
            
            // ìµœì†Œ 5ê°œ í–‰ ìœ ì§€
            if (rows.length < 5) {
                return;
            }
            
            const lastRowInputs = Array.from(inputs).slice(-4);
            const hasContent = lastRowInputs.some(input => input.value.trim() !== '');
            
            if (hasContent) {
                // ë§ˆì§€ë§‰ í–‰ì— ë‚´ìš©ì´ ìˆìœ¼ë©´ ìƒˆ í–‰ ì¶”ê°€
                const currentRowInputs = Array.from(inputs).slice(-8, -4);
                const isLastRowFull = currentRowInputs.every(input => input.value.trim() !== '');
                
                if (!isLastRowFull) {
                    return;
                }
                
                addRow();
            } else {
                // ë§ˆì§€ë§‰ í–‰ì´ ì™„ì „íˆ ë¹„ì–´ìˆê³ , í–‰ì´ 5ê°œë³´ë‹¤ ë§ìœ¼ë©´ ì œê±°
                if (rows.length > 5) {
                    const lastRow = rows[rows.length - 1];
                    const allEmpty = lastRowInputs.every(input => input.value.trim() === '');
                    
                    if (allEmpty) {
                        // ì„ íƒëœ ì…ë ¥ì—ì„œ ì œê±°
                        lastRowInputs.forEach(input => {
                            if (selectedInputs.has(input)) {
                                input.classList.remove('selected');
                                selectedInputs.delete(input);
                            }
                        });
                        
                        lastRow.remove();
                        rowCount--;
                    }
                }
            }
        }

        // ì…€ ì„ íƒ ì²˜ë¦¬
        function handleInputClick(e) {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                const input = e.target;
                
                if (selectedInputs.has(input)) {
                    selectedInputs.delete(input);
                    input.classList.remove('selected');
                } else {
                    selectedInputs.add(input);
                    input.classList.add('selected');
                }
            } else if (!e.shiftKey && !isDragging) {
                // ì¼ë°˜ í´ë¦­ì€ ëª¨ë“  ì„ íƒ í•´ì œ
                if (selectedInputs.size > 0) {
                    selectedInputs.forEach(input => input.classList.remove('selected'));
                    selectedInputs.clear();
                }
            }
        }

        // ë§ˆìš°ìŠ¤ ë‹¤ìš´ - ë“œë˜ê·¸ ì‹œì‘
        function handleMouseDown(e) {
            if (!e.ctrlKey && !e.metaKey && !e.shiftKey) {
                isDragging = true;
                dragStartInput = e.target;
                
                // ê¸°ì¡´ ì„ íƒ í•´ì œ
                selectedInputs.forEach(input => input.classList.remove('selected'));
                selectedInputs.clear();
                
                // í˜„ì¬ ì…€ ì„ íƒ
                selectedInputs.add(e.target);
                e.target.classList.add('selected');
            }
        }

        // ë§ˆìš°ìŠ¤ ì˜¤ë²„ - ë“œë˜ê·¸ ì¤‘ ì„ íƒ
        function handleMouseOver(e) {
            if (isDragging && dragStartInput) {
                e.preventDefault();
                selectRange(dragStartInput, e.target);
            }
        }

        // í¬ì»¤ìŠ¤ ì²˜ë¦¬
        function handleFocus(e) {
            lastFocusedInput = e.target;
        }

        // ë²”ìœ„ ì„ íƒ í•¨ìˆ˜
        function selectRange(start, end) {
            const startRow = parseInt(start.dataset.row);
            const startCol = parseInt(start.dataset.col);
            const endRow = parseInt(end.dataset.row);
            const endCol = parseInt(end.dataset.col);

            const minRow = Math.min(startRow, endRow);
            const maxRow = Math.max(startRow, endRow);
            const minCol = Math.min(startCol, endCol);
            const maxCol = Math.max(startCol, endCol);

            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            selectedInputs.forEach(input => input.classList.remove('selected'));
            selectedInputs.clear();

            // ë²”ìœ„ ë‚´ ëª¨ë“  ì…€ ì„ íƒ
            for (let r = minRow; r <= maxRow; r++) {
                for (let c = minCol; c <= maxCol; c++) {
                    const input = document.querySelector(`input[data-row="${r}"][data-col="${c}"]`);
                    if (input) {
                        selectedInputs.add(input);
                        input.classList.add('selected');
                    }
                }
            }
        }

        // ì¼ê´„ ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
        function openBulkInput() {
            document.getElementById('overlay').classList.add('show');
            document.getElementById('bulkInputModal').classList.add('show');
            document.getElementById('bulkInputField').focus();
        }

        // ì¼ê´„ ì…ë ¥ ëª¨ë‹¬ ë‹«ê¸°
        function closeBulkInput() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('bulkInputModal').classList.remove('show');
            document.getElementById('bulkInputField').value = '';
        }

        // ì¼ê´„ ì…ë ¥ ì ìš©
        function applyBulkInput() {
            const value = document.getElementById('bulkInputField').value;
            selectedInputs.forEach(input => {
                input.value = value;
            });
            
            // ì„ íƒ í•´ì œ
            selectedInputs.forEach(input => input.classList.remove('selected'));
            selectedInputs.clear();
            
            closeBulkInput();
        }

        // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
        function handleKeydown(e) {
            const currentInput = e.target;
            const row = parseInt(currentInput.dataset.row);
            const col = parseInt(currentInput.dataset.col);

            // Delete/Backspace: ì„ íƒëœ ì…€ë“¤ ì‚­ì œ
            if ((e.key === 'Delete' || e.key === 'Backspace') && selectedInputs.size > 1) {
                e.preventDefault();
                selectedInputs.forEach(input => {
                    input.value = '';
                });
                return;
            }

            let nextInput = null;

            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    nextInput = document.querySelector(`input[data-row="${row - 1}"][data-col="${col}"]`);
                    
                    if (e.shiftKey && nextInput) {
                        // Shift + ë°©í–¥í‚¤: ë²”ìœ„ ì„ íƒ
                        if (!lastFocusedInput) lastFocusedInput = currentInput;
                        selectRange(lastFocusedInput, nextInput);
                    } else {
                        // ì¼ë°˜ ë°©í–¥í‚¤: ì„ íƒ í•´ì œ
                        if (selectedInputs.size > 0) {
                            selectedInputs.forEach(input => input.classList.remove('selected'));
                            selectedInputs.clear();
                        }
                        lastFocusedInput = nextInput;
                    }
                    break;
                    
                case 'ArrowDown':
                    e.preventDefault();
                    nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="${col}"]`);
                    
                    if (e.shiftKey && nextInput) {
                        if (!lastFocusedInput) lastFocusedInput = currentInput;
                        selectRange(lastFocusedInput, nextInput);
                    } else {
                        if (selectedInputs.size > 0) {
                            selectedInputs.forEach(input => input.classList.remove('selected'));
                            selectedInputs.clear();
                        }
                        lastFocusedInput = nextInput;
                    }
                    break;
                    
                case 'ArrowLeft':
                    if (currentInput.selectionStart === 0 || e.shiftKey) {
                        e.preventDefault();
                        nextInput = document.querySelector(`input[data-row="${row}"][data-col="${col - 1}"]`);
                        
                        if (e.shiftKey && nextInput) {
                            if (!lastFocusedInput) lastFocusedInput = currentInput;
                            selectRange(lastFocusedInput, nextInput);
                        } else {
                            if (selectedInputs.size > 0) {
                                selectedInputs.forEach(input => input.classList.remove('selected'));
                                selectedInputs.clear();
                            }
                            lastFocusedInput = nextInput;
                        }
                    }
                    break;
                    
                case 'ArrowRight':
                    if (currentInput.selectionStart === currentInput.value.length || e.shiftKey) {
                        e.preventDefault();
                        nextInput = document.querySelector(`input[data-row="${row}"][data-col="${col + 1}"]`);
                        
                        if (e.shiftKey && nextInput) {
                            if (!lastFocusedInput) lastFocusedInput = currentInput;
                            selectRange(lastFocusedInput, nextInput);
                        } else {
                            if (selectedInputs.size > 0) {
                                selectedInputs.forEach(input => input.classList.remove('selected'));
                                selectedInputs.clear();
                            }
                            lastFocusedInput = nextInput;
                        }
                    }
                    break;
                    
                case 'Tab':
                    e.preventDefault();
                    if (e.shiftKey) {
                        // Shift+Tab: ì´ì „ ì…€
                        if (col > 0) {
                            nextInput = document.querySelector(`input[data-row="${row}"][data-col="${col - 1}"]`);
                        } else if (row > 0) {
                            nextInput = document.querySelector(`input[data-row="${row - 1}"][data-col="3"]`);
                        }
                    } else {
                        // Tab: ë‹¤ìŒ ì…€
                        if (col < 3) {
                            nextInput = document.querySelector(`input[data-row="${row}"][data-col="${col + 1}"]`);
                        } else {
                            nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="0"]`);
                            if (!nextInput) {
                                addRow();
                                setTimeout(() => {
                                    nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="0"]`);
                                    if (nextInput) nextInput.focus();
                                }, 10);
                                return;
                            }
                        }
                    }
                    
                    if (selectedInputs.size > 0) {
                        selectedInputs.forEach(input => input.classList.remove('selected'));
                        selectedInputs.clear();
                    }
                    lastFocusedInput = nextInput;
                    break;
                    
                case 'Enter':
                    e.preventDefault();
                    nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="${col}"]`);
                    if (!nextInput) {
                        addRow();
                        setTimeout(() => {
                            nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="${col}"]`);
                            if (nextInput) nextInput.focus();
                        }, 10);
                        return;
                    }
                    
                    if (selectedInputs.size > 0) {
                        selectedInputs.forEach(input => input.classList.remove('selected'));
                        selectedInputs.clear();
                    }
                    lastFocusedInput = nextInput;
                    break;
            }

            if (nextInput) {
                nextInput.focus();
            }
        }

        // ë¶™ì—¬ë„£ê¸° ì²˜ë¦¬
        function handlePaste(e) {
            const pasteData = e.clipboardData.getData('text');
            
            // ì—¬ëŸ¬ ì…€ì´ ì„ íƒëœ ê²½ìš°: ë™ì¼í•œ ë‚´ìš©ì„ ëª¨ë“  ì…€ì— ë¶™ì—¬ë„£ê¸°
            if (selectedInputs.size > 1) {
                e.preventDefault();
                const value = pasteData.trim();
                selectedInputs.forEach(input => {
                    input.value = value;
                });
                return;
            }
            
            // íƒ­ ë˜ëŠ” ê°œí–‰ìœ¼ë¡œ êµ¬ë¶„ëœ ë°ì´í„°ì¸ì§€ í™•ì¸
            if (pasteData.includes('\t') || pasteData.includes('\n')) {
                e.preventDefault();
                
                const currentInput = e.target;
                const startRow = parseInt(currentInput.dataset.row);
                const startCol = parseInt(currentInput.dataset.col);
                
                const rows = pasteData.split('\n').filter(row => row.trim() !== '');
                
                rows.forEach((rowData, rowIndex) => {
                    const cells = rowData.split('\t');
                    const targetRow = startRow + rowIndex;
                    
                    // í•„ìš”í•œ ë§Œí¼ í–‰ ì¶”ê°€
                    while (rowCount <= targetRow) {
                        addRow();
                    }
                    
                    cells.forEach((cellData, cellIndex) => {
                        const targetCol = startCol + cellIndex;
                        if (targetCol <= 3) {
                            const input = document.querySelector(`input[data-row="${targetRow}"][data-col="${targetCol}"]`);
                            if (input) {
                                input.value = cellData.trim();
                            }
                        }
                    });
                });
            }
        }

        // JSON ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
        function generateJSON() {
            const inputs = document.querySelectorAll('#tableBody input');
            const emojis = [];

            // 4ê°œì”© ë¬¶ì–´ì„œ ì²˜ë¦¬ (fileName, name, category, aliases)
            for (let i = 0; i < inputs.length; i += 4) {
                const fileName = inputs[i].value.trim();
                const name = inputs[i + 1].value.trim();
                const category = inputs[i + 2].value.trim();
                const aliasesStr = inputs[i + 3].value.trim();

                // ëª¨ë“  í•„ë“œê°€ ë¹„ì–´ìˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°
                if (!fileName && !name && !category && !aliasesStr) {
                    continue;
                }

                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                if (!fileName || !name) {
                    alert(`${Math.floor(i / 4) + 1}ë²ˆì§¸ í–‰: íŒŒì¼ëª…ê³¼ ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.`);
                    return;
                }

                // aliases ì²˜ë¦¬
                const aliases = aliasesStr
                    ? aliasesStr.split(',').map(a => a.trim()).filter(a => a !== '')
                    : [];

                emojis.push({
                    downloaded: true,
                    fileName: fileName,
                    emoji: {
                        name: name,
                        category: category || "",
                        aliases: aliases
                    }
                });
            }

            if (emojis.length === 0) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì´ëª¨ì§€ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // JSON ìƒì„±
            const metaJSON = {
                metaVersion: 2,
                host: "json.buttersc.one",
                exportedAt: new Date().toISOString(),
                emojis: emojis
            };

            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const jsonStr = JSON.stringify(metaJSON, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'meta.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
            const btn = document.getElementById('generateBtn');
            btn.textContent = 'ë‹¤ìš´ë¡œë“œ ì„±ê³µ!';
            btn.classList.add('success');

            // 3ì´ˆ í›„ ì›ë˜ëŒ€ë¡œ
            setTimeout(() => {
                btn.textContent = 'meta.json ë§Œë“¤ê¸°';
                btn.classList.remove('success');
            }, 3000);
        }

        // íŒŒì¼ëª… í™•ì¥ì ì¼ê´„ ì¶”ê°€
        function addExtension() {
            const extension = document.getElementById('extensionInput').value.trim();
            if (!extension) return;

            const inputs = document.querySelectorAll('#tableBody input');

            // íŒŒì¼ëª… ì»¬ëŸ¼ë§Œ ì²˜ë¦¬ (data-col="0")
            for (let i = 0; i < inputs.length; i += 4) {
                const fileNameInput = inputs[i];
                if (fileNameInput && fileNameInput.value.trim()) {
                    const currentValue = fileNameInput.value.trim();
                    
                    // ì´ë¯¸ í™•ì¥ìê°€ ìˆëŠ”ì§€ í™•ì¸
                    if (!currentValue.includes('.') || !currentValue.endsWith(extension)) {
                        // ê¸°ì¡´ í™•ì¥ì ì œê±° í›„ ìƒˆ í™•ì¥ì ì¶”ê°€
                        const baseName = currentValue.split('.')[0];
                        fileNameInput.value = baseName + extension;
                    }
                }
            }
        }

        // ì´ë¦„ ì ‘ë‘ì‚¬ ì¼ê´„ ì¶”ê°€
        function addPrefix() {
            const prefix = document.getElementById('prefixInput').value.trim();
            if (!prefix) return;

            const inputs = document.querySelectorAll('#tableBody input');

            // ì´ë¦„ ì»¬ëŸ¼ë§Œ ì²˜ë¦¬ (data-col="1")
            for (let i = 1; i < inputs.length; i += 4) {
                const nameInput = inputs[i];
                if (nameInput && nameInput.value.trim()) {
                    nameInput.value = prefix + nameInput.value.trim();
                }
            }

            document.getElementById('prefixInput').value = '';
        }

        // ì´ë¦„ ì ‘ë¯¸ì‚¬ ì¼ê´„ ì¶”ê°€
        function addSuffix() {
            const suffix = document.getElementById('suffixInput').value.trim();
            if (!suffix) return;

            const inputs = document.querySelectorAll('#tableBody input');

            // ì´ë¦„ ì»¬ëŸ¼ë§Œ ì²˜ë¦¬ (data-col="1")
            for (let i = 1; i < inputs.length; i += 4) {
                const nameInput = inputs[i];
                if (nameInput && nameInput.value.trim()) {
                    nameInput.value = nameInput.value.trim() + suffix;
                }
            }

            document.getElementById('suffixInput').value = '';
        }

        // ì¹´í…Œê³ ë¦¬ ì¼ê´„ ì¶”ê°€
        function addCategory() {
            const category = document.getElementById('categoryInput').value.trim();
            if (!category) return;

            const inputs = document.querySelectorAll('#tableBody input');

            // ì¹´í…Œê³ ë¦¬ ì»¬ëŸ¼ë§Œ ì²˜ë¦¬ (data-col="2")
            for (let i = 2; i < inputs.length; i += 4) {
                const categoryInput = inputs[i];
                if (categoryInput) {
                    // ë¹ˆ ì…€ì´ì–´ë„ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
                    categoryInput.value = category;
                }
            }

            document.getElementById('categoryInput').value = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

